准备：在/目录创建，dongm目录，执行

```bash
mkdir /dongm
cd /dongm
```

创建application、software、bak、data等目录

```bash
[root@localhost dongm]# mkdir application software bak data
[root@localhost dongm]# mkdir application/web 
[root@localhost dongm]# mkdir application/parent 
[root@localhost dongm]# vim  /dongm/application/nacos/conf/application.properties
```

文件夹说明

    application：   统一软件安装目录
    software：      统一软件安装包存放目录
    bak：           统一本机备份目录
    data:           统一本机原文挂接相关内容
    web：  前端项目
    parent:后端项目

---

### 1.安装docker服务（要求Centos版本7以上）

1.  查看 CentOS 系统的版本

    ```bash
    [root@localhost software]# cat /etc/system-release
    CentOS Linux release 7.4.1708 (Core)
    ```

2.  查看内核版本

    ```bash
    [root@localhost software]# uname -r
    3.10.0-693.el7.x86_64
    ```

3.  [下载离线docker安装包]()

4.  下载完成后，上传到服务器`/dongm/software`目录，
    [参考文件](https://www.cnblogs.com/zhaochunxue/p/13388700.html)

5.  解压：

    ```bash
    tar -zxvf docker-20.10.2.tgz
    ```

6.  解压后的文件移动到`/usr/bin/`目录下

    ```bash
    cp docker/* /usr/bin/
    ```

7.将docker注册为service

```bash
    vim /etc/systemd/system/docker.service

    [Unit]
    Description=Docker Application Container Engine
    Documentation=https://docs.docker.com
    After=network-online.target firewalld.service
    Wants=network-online.target
      
    [Service]
    Type=notify
    # the default is not to use systemd for cgroups because the delegate issues still
    # exists and systemd currently does not support the cgroup feature set required
    # for containers run by docker
    ExecStart=/usr/bin/dockerd
    ExecReload=/bin/kill -s HUP $MAINPID
    # Having non-zero Limit*s causes performance problems due to accounting overhead
    # in the kernel. We recommend using cgroups to do container-local accounting.
    LimitNOFILE=infinity
    LimitNPROC=infinity
    LimitCORE=infinity
    # Uncomment TasksMax if your systemd version supports it.
    # Only systemd 226 and above support this version.
    #TasksMax=infinity
    TimeoutStartSec=0
    # set delegate yes so that systemd does not reset the cgroups of docker containers
    Delegate=yes
    # kill only the docker process, not all processes in the cgroup
    KillMode=process
    # restart the docker process if it exits prematurely
    Restart=on-failure
    StartLimitBurst=3
    StartLimitInterval=60s
      
    [Install]
    WantedBy=multi-user.target
```

1.  添加文件权限并启动docker

    ```bash
    chmod +x /etc/systemd/system/docker.service
    ```

2.  重新加载配置文件

    ```bash
    systemctl daemon-reload
    ```

3.  启动Docker

    ```bash
    systemctl start docker
    ```

4.  设置开机自启

    ```bash
    systemctl enable docker.service
    ```

5.  验证查看Docker状态

    ```bash
    systemctl status docker
    ```

6.  查看Docker版本

    ```bash
    docker -v
    ```

---

###  2.安装jdk

1.  [下载连接](https://download.java.net/openjdk/jdk8u41/ri/openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz)

2.  上传到服务器，解压文件 ：

    ```bash
    tar -zxvf openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz
    ```

3.  移动jdk安装包到/usr/local/java/：

    ```bash
    mv java-se-8u41-ri/ /usr/local/java/
    ```

4.  配置Java环境变量执行：

    ```bash
    vi /etc/profile
    ```

添加以下内容

```bash
    export JAVA_HOME=/usr/local/java/
    export PATH=$JAVA_HOME/bin:$PATH
    export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
```

让`/etc/profile`文件修改后立即生效,并用javac验证：

```bash
    [root@localhost dongm]# source /etc/profile
    [root@localhost dongm]# javac
    Usage: javac <options> <source files>
    where possible options include:
      -g                         Generate all debugging info
      -g:none                    Generate no debugging info
      -g:{lines,vars,source}     Generate only some debugging info
      -nowarn                    Generate no warnings
      -verbose                   Output messages about what the compiler is doing
```

---

### 3.安装nacos

1.  [下载nacos镜像](https://nacos.io/download/nacos-server/?spm=5238cd80.2ef5001f.0.0.3f613b7cc2c2ZO)
    
2.  下载完之后上传到服务器`/dongm/software`目录

3.  Docker加载nacos镜像：

    ```bash
    [root@localhost dongm]# docker load -i nacos1.4.2
    4826cdadf1ef: Loading layer  207.8MB/207.8MB
    c109c5f12298: Loading layer  2.048kB/2.048kB
    103e178bf05f: Loading layer  584.4MB/584.4MB
    6c94a62a7f80: Loading layer  77.99MB/77.99MB
    c0856af71bf4: Loading layer  84.65MB/84.65MB
    194d7c7fc51d: Loading layer  22.17MB/22.17MB
    1b43bf6621cc: Loading layer  8.192kB/8.192kB
    c38a33ae7078: Loading layer  5.632kB/5.632kB
    125221f3216d: Loading layer  4.096kB/4.096kB
    ec76b411c7b0: Loading layer  3.072kB/3.072kB
    880577f029d3: Loading layer  8.192kB/8.192kB
    Loaded image: nacos/nacos-server:1.4.2
    ```

4.  验证docker中是否有`nacos`镜像

    ```bash
    [root@localhost dongm]# docker images
    REPOSITORY           TAG       IMAGE ID       CREATED        SIZE
    nacos/nacos-server   1.4.2     938169b118c7   7 months ago   956MB
    ```

5.  启动nacos服务执行：

    ```bash
    docker run --name nacos -d -p 8848:8848 -v /dongm/application/nacos/conf/application.properties:/home/nacos/conf/application.properties --privileged=true --restart=always --env MODE=standalone --env NACOS_AUTH_ENABLE=true nacos/nacos-server:1.4.2
    ```

<font color="red">（此命令仅供参考，需根据现场环境安装目录进行调整，以及确认现场安装的nacos镜像名称和版本是否是nacos/nacos-server:1.4.1）</font>
6\.  开启`nacos`验证
找到上面`nacos`的挂载配置文件
![开启nacos验证](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/开启nacos验证.png)
然后重启nacos。

报错：

```bash
vi /usr/lib/sysctl.d/00-system.conf
net.ipv4.ip\_forward=1
systemctl restart network\
sysctl net.ipv4.ip\_forward
```

1.  验证是否启动`nacos`
    如果返回为`“net.ipv4.ip\_forward = 1”`则表示`成功`了 重启容器即可。

2.  执行 docker ps 查看nacos容器id，

    ```bash
    [root@localhost dongm]# docker ps
    CONTAINER ID   IMAGE                      COMMAND                  CREATED          STATUS          PORTS                    NAMES
    9f93ecf7d89f   nacos/nacos-server:1.4.2   "bin/docker-startup.…"   27 seconds ago   Up 26 seconds   0.0.0.0:8848->8848/tcp   nacos
    ```

3.  容器id查看`nacos`启动日志

    ```bash
    docker logs -t -f –tail=500 nacos
    ```

---

### 4.安装MySQL

1.  [下载MySQL镜像](https://downloads.mysql.com/archives/community/)
    
2.  然后上传到服务器，`/dongm/software`目录，在`/dongm/application/mysql`目录下创建 `conf`，`data`，`logs`文件夹

    ```bash
    mkdir conf data logs
    ```

文件夹说明

```bash
conf：MySQL配置文件
data：MySQL挂载磁盘目录
logs：MySQL日志
```

3\.  把MySQL镜像加载到docker容器

```bash
    [root@localhost dongm]# docker load -i mysql8.0.26 
    764055ebc9a7: Loading layer  72.53MB/72.53MB
    71a14cc55692: Loading layer  338.4kB/338.4kB
    50854886015e: Loading layer  9.557MB/9.557MB
    1952fb2b0eb4: Loading layer  4.202MB/4.202MB
    893f6aea2ce2: Loading layer  2.048kB/2.048kB
    b8d0aeaeeee8: Loading layer  53.77MB/53.77MB
    98cf3cd0d5c6: Loading layer  5.632kB/5.632kB
    c0276df1761d: Loading layer  3.584kB/3.584kB
    390bb22cbbaa: Loading layer  378.8MB/378.8MB
    8b6b92092fe4: Loading layer  5.632kB/5.632kB
    e01c5a344068: Loading layer  17.92kB/17.92kB
    d0d8a22eb77f: Loading layer  1.536kB/1.536kB
    Loaded image: mysql:latest
```

运行

```bash
docker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql
```

1.  查看是docker中是否有MySQL的镜像

    ```bash
    [root@localhost dongm]# docker images
    REPOSITORY           TAG       IMAGE ID       CREATED        SIZE
    mysql                latest    95db2e2bd882   4 months ago   514MB
    nacos/nacos-server   1.4.2     938169b118c7   7 months ago   956MB
    ```

<font color="red">补充：如果发现MySQL版本号为空，TAG为latest</font>
执行：`docker tag 镜像id 镜像名:版本号`
例如：`docker tag 95db2e2bd882 mysql:8.0.26`

1.  进入mysql容器内部查看MySQL是否正常运行

    ```bash
    docker exec -it feff3f0db6b3 /bin/bash
    ```

2.  连接MySQL：`mysql -uroot -p123456`

    ```sql
    root@cbf44530229d:/# mysql -uroot -p123456
    mysql: [Warning] Using a password on the command line interface can be insecure.
    Welcome to the MySQL monitor.  Commands end with ; or \g.
    Your MySQL connection id is 8
    Server version: 8.0.26 MySQL Community Server - GPL

    Copyright (c) 2000, 2021, Oracle and/or its affiliates.

    Oracle is a registered trademark of Oracle Corporation and/or its
    affiliates. Other names may be trademarks of their respective
    owners.

    Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

    mysql>
    ```

3.  查看已有库，执行`show databases;`，如下代表安装成功

    ```sql
    mysql> show databases;
    +--------------------+
    | Database           |
    +--------------------+
    | information_schema |
    | mysql              |
    | performance_schema |
    | sys                |
    +--------------------+
    4 rows in set (0.04 sec)
    ```

4.  复制MySQL配置文件my.cnf，首先查看MySQL容器名称，执行

    `docker ps`

然后执行复制文件命令

```bash
docker cp mysql:/etc/mysql/my.cnf /dongm/application/mysql/conf/
```

![复制my.cnf配置文件](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/复制my.cnf配置文件.png)
如图，在`conf`文件夹看到`my.cnf`代表复制成功

#### 4.1 安装MySQL并挂载数据

1.  首先停掉并删除上面安装好的MySQL

    ```bash
    停止：docker stop f87a77ca3005
    删除：docker rm f87a77ca3005
    ```

2.  data文件夹赋权
    `chmod 777 data/`
    启动MySQL

    ```bash
    docker run  -d -v /dongm/application/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /dongm/application/mysql/logs:/var/log -v /dongm/application/mysql/data:/var/lib/mysql  -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=123456 mysql
    ```

3.  确认MySQL是否正常启动

*   查看MySQL容器id：`docker ps`
*   进入MySQL内部：`docker exec -it 1af7ffabc8cb /bin/bash`
*   连接MySQL：`mysql -uroot -p123456`
*   查看表：`show databases;`

#### 4.2 MySQL自动重启

1.  首先和上面的步骤一样，先停掉MySQL，然后删除
    停止MySQL：`docker stop 1af7ffabc8cb`
    删除MySQL：`docker rm 1af7ffabc8cb`
2.  删除data 目录下上次挂载产生的数据
    执行：`rm -rf data/*`
    ![删除MySQL的data数据](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/删除MySQL的data数据.png)
    删除后，进到data 目录确认是否正确删除
3.  重新启动MySQL，添加参数：`--restart=always`代表会自动重启，完整命令如下：

    ```bash
    docker run --restart=always -d -v /dongm/application/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /dongm/application/mysql/logs:/var/log -v /dongm/application/mysql/data:/var/lib/mysql -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=dongm@2023 mysql --lower_case_table_names=1
    ```

*   查看MySQL是否安装成功，执行如下命令
*   查看MySQL容器id：`docker ps`
*   进入MySQL内部：`docker exec -it 6be82324a2ec /bin/bash`
*   连接MySQL：`mysql -uroot -pdongm@2023`
*   查看表：`show databases;`
*   忽略大小写，docker mysql默认区分大小写的：`--lower_case_table_names=1`

1.  进入data目录查看是否正确挂载，如下代表正确安装MySQL
    ![删除MySQL的data数据](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/删除MySQL的data数据.png)

---

### 5. 安装redis

1.  [下载redis镜像](https://download.redis.io/releases/)
    
2.  然后上传到服务器：`/dongm/software`目录

3.  加载redis镜像

    ```bash
    [root@localhost software]# docker load -i redis6.2.4 
    245c9d23f653: Loading layer [==================================================>]  338.4kB/338.4kB
    ebef6caacb96: Loading layer [==================================================>]  4.194MB/4.194MB
    0b7b774038f0: Loading layer [==================================================>]  31.71MB/31.71MB
    a71d36a87572: Loading layer [==================================================>]  2.048kB/2.048kB
    9e1fddfb3a22: Loading layer [==================================================>]  3.584kB/3.584kB
    Loaded image: redis:latest
    ```

4.  执行 `docker images`查看是否有redis的镜像

    ```bash
    [root@localhost software]# docker images
    REPOSITORY           TAG       IMAGE ID       CREATED        SIZE
    mysql                latest    95db2e2bd882   4 months ago   514MB
    redis                latest    08502081bff6   5 months ago   105MB
    nacos/nacos-server   1.4.2     938169b118c7   7 months ago   956MB
    ```

5.  运行redis

    ```bash
    [root@localhost software]# docker run --name redis -p 6379:6379 -d --restart=always redis:6.2.4  redis-server --appendonly yes --requirepass "dongm@2023"
    69dd281384c00b45c6c10f815259a53edd84282ed3f7c0c2cee1372d791673f0
    [root@localhost software]# docker ps
    CONTAINER ID   IMAGE                      COMMAND                  CREATED          STATUS          PORTS                    NAMES
    69dd281384c0   redis:latest               "docker-entrypoint.s…"   31 seconds ago   Up 30 seconds   0.0.0.0:6379->6379/tcp   redis
    3f84edcf05f0   nacos/nacos-server:1.4.2   "bin/docker-startup.…"   14 hours ago     Up 14 hours     0.0.0.0:8848->8848/tcp   nacos
    ```

6.  进入redis

    ```bash
    [root@localhost software]# docker exec -it 69dd281384c0  /bin/bash
    root@69dd281384c0:/data#
    ```

7.  登录验证

    ```bash
    root@69dd281384c0:/data# redis-cli
    127.0.0.1:6379>
    ```

---

### 6.安装nginx

1.  [下载nginx的镜像](https://nginx.org/en/download.html)
    
2.  上传到服务器的`/dongm/software`目录

3.  加载到docker 容器：`docker load -i nginx`

    ```sql
    [root@localhost software]# docker images
    REPOSITORY           TAG       IMAGE ID       CREATED        SIZE
    <none>               <none>    4146b18ae794   3 months ago   22.7MB
    mysql                latest    95db2e2bd882   4 months ago   514MB
    redis                latest    08502081bff6   5 months ago   105MB
    nacos/nacos-server   1.4.2     938169b118c7   7 months ago   956MB
    ```

4.  TAG为空，进行手动更新

    ```bash
    [root@localhost software]# docker tag 4146b18ae794 nginx:1.20.1
    [root@localhost software]# docker images
    REPOSITORY           TAG       IMAGE ID       CREATED        SIZE
    nginx                1.20.1    4146b18ae794   3 months ago   22.7MB
    mysql                latest    95db2e2bd882   4 months ago   514MB
    redis                latest    08502081bff6   5 months ago   105MB
    nacos/nacos-server   1.4.2     938169b118c7   7 months ago   956MB
    ```

5.  创建一下目录结构：

    ```bash
    mkdir -p /dongm/application/nginx/conf
    mkdir -p /dongm/application/nginx/web
    ```

6.  复制容器内部配置文件到外面，执行

    ```bash
    docker cp nginx:/etc/nginx/nginx.conf /dongm/application/nginx/conf/
    docker cp nginx:/etc/nginx/conf.d/default.conf /dongm/application/nginx/conf/
    ```

7.  修改 `/dongm/application/nginx/conf/`下的`default.conf`配置文件

    ```ruby
    #nacos 集群配置
    upstream nacos-servers {
            server 47.98.228.219:8848;
    }
    #后台Java网关服务集群配置
    upstream java-server {
            server 47.98.228.219:8004;
    }
    
    server {
        listen       80;
        listen  [::]:80;
        server_name localhost;
    
        #charset koi8-r;
        #access_log  /var/log/nginx/host.access.log  main;
    
            #前端包配置
        location / {
            root   /dongm/application/web/dist;
            index  index.html index.htm;
            try_files $uri $uri/ /index.html;
        }


```nginx
    # 直接使用容器的名称进行访问
    location /api/{
                proxy_pass   http://java-server;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header REMOTE-HOST $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection $connection_upgrade;
    }
```


~~~nginx
    #nacos集群配置
    location /cluster/ {
            proxy_pass http://nacos-servers/;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}
```
~~~

8.  启动nginx容器

    ```bash
    docker run -d -p 80:80 --name nginx -v /dongm/application/web/dist:/dongm/application/nginx/web/dist -v /dongm/application/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /dongm/application/nginx/conf/default.conf:/etc/nginx/conf.d/default.conf -v /dongm/application/nginx/logs:/var/log/nginx nginx:1.20.1
    ```

9.  进入nginx容器内部可以看到容器内部也创建了相对应的目录

---

### 7.安装node

#### 1. 安装 nvm

 ```bash
   curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
 ```

1.1 安装完成后，重启终端或手动加载 nvm 环境

```bash
source ~/.bashrc  # 或 ~/.zshrc（根据你的 shell 配置文件）
```

1.2 验证 nvm 安装

```bash
nvm --version  # 输出 0.39.7 或更高版本
```

#### 2. 使用 nvm 安装 Node.js

2.1 **安装最新稳定版**：

```bash
nvm install stable  # 安装最新稳定版 Node.js
```

2.2 **安装指定版本**

```bash
nvm install 14
```

2.3 **查看已安装版本**

``` bash
nvm ls  # 列出所有已安装版本，带 `->` 的为当前使用版本
```

2.4 **切换版本**

```bash
nvm use 20  # 切换到 20.x 版本
```

2.5 **设置默认版本**（终端重启后自动生效）

```bash
nvm alias default 14 # 将 20.x 设为默认版本
```

#### 3. 验证安装

3.1 基础验证

```bash
node -v  # 输出 Node.js 版本号（如 v20.10.0）
npm -v   # 输出 npm 版本号（如 10.2.3）
```

3.2 功能验证（运行测试脚本）

创建一个简单的 Node.js 文件 `app.js`：

```
// app.js
console.log('Node.js 安装成功！当前版本：', process.version);
```

运行脚本：

```bash
node app.js  # 输出：Node.js 安装成功！当前版本：v20.10.0
```

#### 4. 版本管理与升级

4.1 使用 NodeSource 安装的版本升级

```bash
# CentOS/RHEL
sudo yum update -y nodejs  # 或 sudo dnf update -y nodejs
```

4.2 使用 nvm 管理版本

**安装新版本**

```bash
nvm install 21  # 安装 21.x 版本
```

**切换到新版本**

```bash
nvm use 21
```

**卸载旧版本**

```bash
nvm uninstall 18  # 卸载 18.x 版本（需先切换到其他版本）
```

---

### 8.安装docker-compose

1.  [从官网下载](https://github.com/docker/compose/releases)

2.  下载完成后，上传到 `/dongm/software` 目录下

3.  执行

    ```bash
    [root@localhost software]# mv docker-compose-linux-x86_64 /usr/local/bin/docker-compose
    ```

4.  执行赋权命令

    ```bash
    [root@localhost software]# chmod +x /usr/local/bin/docker-compose
    ```

5.  验证：

```bash
[root@localhost software]# docker-compose -v
Docker Compose version v2.0.1
```

---

### 9.通过docker-compose启动ES

1.  软件及`docker-compose.yml`文件上传到服务器指定位置：`/dongm/application/elasticsearch`，创建对应的文件夹
    ![ES对应文件夹](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/ES对应文件夹.png)
    创建 `data` 、`config`、 `plugins` 文件夹，文件夹说明如下：

    ```bash
    data    : 文件夹为空，里面做了es数据挂宅
    config 	: 里面可以建一个空的文件：vim elasticsearch.yml
    plugins : 里面存放es 需要的分词插件，目录结构如下
    ```

    授权data文件夹

    ```bash
    chmod 777 data
    ```

下载Ik 和pinyin插件
分别解压到对应的文件夹里

```bash
unzip elasticsearch-analysis-ik-7.10.1.zip -d ik
unzip elasticsearch-analysis-pinyin-7.10.1.zip -d pinyin
```

![ES目录](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/ES目录.png)

1.  验证是否安装：`docker-compose` 执行：`docker-compose -v`

2.  分别加载`elasticsearch` 相关镜像：

    ```bash
    docker load -i elasticsearch7.10.1 
    docker load -i kibana7.10.1
    docker load -i elastichd
    ```

3.  编写`docker-compose.yml`

    ```ruby
    version: '2'

    services:
      es01:
        image: elasticsearch:7.10.1
        container_name: es01
        environment:
          - network.host=0.0.0.0
          - http.cors.enabled=true
          - http.cors.allow-origin=*
          - discovery.type=single-node
          - "ES_JAVA_OPTS=-Xms1024m -Xmx1024m"
        ulimits:
          nproc: 65535
          memlock:
            soft: -1
            hard: -1
        volumes:
          - /dongm/application/elasticsearch/data:/usr/share/elasticsearch/data      
          - /dongm/application/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
          - /dongm/application/elasticsearch/plugins:/usr/share/elasticsearch/plugins
        ports:
          - 9200:9200
        networks:
          - elastic
      
      elastichd:
        image: containerize/elastichd:latest
        container_name: elasticsearch-hd
        networks:
          - elastic
        ports:
          - 9800:9800
        depends_on:
          - es01
        links:
          - "es01:demo"

      kibana:
        image: docker.elastic.co/kibana/kibana:7.10.1
        container_name: kibana7
        environment:
          - ELASTICSEARCH_HOSTS=http://服务器ip:9200
          - I18N_LOCALE=zh-CN
          - XPACK_GRAPH_ENABLED=true
          - TIMELION_ENABLED=true
          - XPACK_MONITORING_COLLECTION_ENABLED="true"
        ports:
          - 5601:5601
        depends_on:
          - es01
        networks:
          - elastic

    networks:
      elastic:
        driver: bridge
    ```

4.  然后通过：`docker-compose up` 查看启动日志，正常运行的话，可以后台运行：`docker-compose up -d`

5.  启动后可以通过浏览器访问es来确认是否部署成功
    <http://服务器ip:9200>
    <http://服务器ip:9800>
    <http://服务器ip:5601>

---

### 10.elasticsearch开启验证

1.  修改配置文件，添加如下内容
    ![ES开启验证](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/ES开启验证.png)

    ```ruby
    http.cors.allow-headers: Authorization
    # 这条配置表示开启xpack认证机制
    xpack.security.enabled: true
    xpack.security.transport.ssl.enabled: true
    ```

2.  进到容器内部开始设置es密码

*   `docker ps `：查看运行的es容器id
*   `docker exec -it 容器id /bin/sh `：进入es容器内部
    进入到 bin目录：cd bin
*   然后执行：`elasticsearch-setup-passwords interactive` 开始设置密码
*   密码设置需要多次输入，不用担心，就一直根据提示进行输入密码就好了
*   密码建议设置为：`dongm@2023elastic`
*   最后密码设置完成，退出容器，重启es ,退出命令：exit

1.  验证密码是否设置成功,输入账号密码，成功进入es

2.  `Kibana`开启验证连接
    找到kibana的配置文件，添加以下内容
    ![Kibana设置密码](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/Kibana设置密码.png)

    ```ruby
    #这里是在elasticsearch设置密码时的值
    elasticsearch.username: 'elastic'
    elasticsearch.password: 'dongm@2023elastic'
    ```

*   如果kibana未做配置文件挂载，需要进到`kibana`容器内部去修改配置文件
*   查看kibana容器id：`docker ps`
*   进入容器内部：`docker exec -it 容器id /bin/sh`
*   进到配置文件目录：`cd config`
*   编辑kibana文件添加上面的内容：`vim kibana.yml`

访问`kibana`验证是否成功：<http://ip:5601>

#### 限制内存大小

docker增加指令`-m`限制内存大小`docker -m 500M`

```bash
docker run --name public-server -m 500M -v /mnt/dongm/data/:/mnt/dongm/data/ -e PROFILE='pro' -e NACOS_CONFIG_SERVER_ADDRESS='ip:8848' -e SPRING_CLOUD_NACOS_USERNAME='nacos' -e SPRING_CLOUD_NACOS_PASSWORD='dongm@nacos' --net=host
```

---

### 1x. 遇到问题

#### 1x.1 FlowableWrongDbException: version mismatch: library version is ‘6.6.0.0‘, db version is 5.99.0.0

<b>解决方法</b>

```sql
确认MySQL是否区分大小写，MySQL中执行：
show global variables like '%lower_case%';
```

![MySQL区分大小写](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/MySql%E5%8C%BA%E5%88%86%E5%A4%A7%E5%B0%8F%E5%86%99.png)

---

#### 1x.2 系统内存不够

<b>解决方法</b>
docker增加指令-m限制内存大小

```bash
docker run --name public-server -m 500M 
```

---

#### 1x.3 docker-compose up启动ES，ES报错：` failed to load plugins analysis-ik due to jar hell`

![ES启动失败](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/ES%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99%E4%BF%A1%E6%81%AF.png) <b>解决方法</b>
将.zip的包下载下来，解压缩，把压缩包放进/dongm/application/elasticsearch/plugins/目录下

1.  将分词插件ZIP压缩包于系统中解压。执行

    unzip xxx.ik.zip
    unzip xxx.pinyin.zip

2.  如果提示`-bash: unzip: 未找到命令`

*   有网情况下：执行`yum install -y unzip`
*   无网情况下：[访问这里](http://www.rpmfind.net/linux/rpm2html/search.php?query=zip%28x86-64%29)下载对应版本的unzip和zip文件进行安装。这个网页打开以后看起来像这样。
    ![离线下载unzip](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/%E4%B8%8B%E8%BD%BDunzip.png)
    这里我使用的是`unzip-6.0-21.el7.x86_64.rpm`和`zip-3.0-11.el7.x86_64.rpm`这两个文件。
*   执行命令
    rpm -ivh unzip-6.0-21.el7.x86\_64.rpm
    rpm -ivh zip-3.0-11.el7.x86\_64.rpm
*   再次解压`unzip xxx.ik.zip`、`unzip xxx.pinyin.zip`。

1.  重启es即可

---

#### 1x.4 nginx上传文件过大失败

打开nginx.config文件，添加如下代码

```bash
client_max_body_size 200M;
```

---

####  1x.5 执行node -v 报错：node: error while loading shared libraries: libatomic.so.1: cannot open shared object file: No such file or directory

系统缺少 `libatomic`库，执行下面命令

```bash
sudo yum install libatomic
```

---

#### 执行 node -v，报错

```bash
node: /lib64/libstdc++.so.6: version CXXABI_1.3.11' not found (required by node)
node: /lib64/libstdc++.so.6: version CXXABI_1.3.8' not found (required by node)
node: /lib64/libstdc++.so.6: version GLIBCXX_3.4.20' not found (required by node)
node: /lib64/libstdc++.so.6: version GLIBCXX_3.4.21' not found (required by node)
node: /lib64/libstdc++.so.6: version CXXABI_1.3.9' not found (required by node)
node: /lib64/libm.so.6: version GLIBC_2.27' not found (required by node)
node: /lib64/libc.so.6: version GLIBC_2.27' not found (required by node)
node: /lib64/libc.so.6: version GLIBC_2.28' not found (required by node)
node: /lib64/libc.so.6: version `GLIBC_2.25' not found (required by node)
```

 **Linux 系统库版本过低**导致的 Node.js 无法运行问题

1. 执行

``` bash
cat /etc/os-release
ldd --version
```

如果看到

+ CentOS 7.x
+ glibc 2.17

2. **安装兼容的 Node 版本**

CentOS 7 **最高可稳定运行**：

```bash
nvm install 14
nvm use 14
node -v
```

---

#### 1x.6 Kibana server is not ready yet

![kibana异常](https://raw.githubusercontent.com/DongMing0103/MarkdownCloudImage/master/data/work/kibana%E5%BC%82%E5%B8%B8.jpg)
